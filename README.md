# Unreal MCP ‚Äî Remote control for Unreal Editor via MCP (UE 5.6)

> Contr√¥lez l‚Äô√âditeur Unreal depuis un serveur MCP (Python) et des agents externes.
> Version compatible **UE 5.6**. R√©seau fiabilis√© avec **Protocol v1** (framed JSON + handshake + ping/pong).

## ‚ú® Fonctionnalit√©s actuelles
- **Protocol v1** : framing binaire (uint32 + JSON), handshake versionn√©, heartbeats, sch√©ma d‚Äôerreurs.
- **S√©curit√©** : gates **AllowWrite / DryRun / AllowedContentRoots / Tool allow/deny-list** + audit JSON.
- **Transactions & Undo** : toutes les mutations sont encapsul√©es dans des transactions √©diteur.
- **Source Control int√©gr√©** : `sc.status / sc.checkout / sc.add / sc.revert / sc.submit` (provider-agnostic).
- **Assets v1 (lecture)** : `asset.find / asset.exists / asset.metadata` via Asset Registry.
- **Assets v2 (CRUD)** : `asset.create_folder / asset.rename / asset.delete / asset.fix_redirectors / asset.save_all`.
- **Assets v3 (Batch Import)** : `asset.batch_import` pour importer FBX/Textures/Audio avec presets, options et SCM.
- **Sequencer v1** : `sequence.create` pour g√©n√©rer un Level Sequence (fps, dur√©e, √©valuation, cam√©ra/camera-cut/bind optionnels).
- **Actors v1 (Editor)** : `actor.spawn / actor.destroy / actor.attach / actor.transform / actor.tag` (transactions, s√©lection, audit).
- **Camera helpers (Editor)** : `level.select / viewport.focus / camera.bookmark` (navigation + bookmarks, session & persistance).
- **Settings Plugin** : Project Settings ‚Üí **Plugins ‚Üí Unreal MCP** (Network, Security, SCM, Logging, Diagnostics).

## üîß Installation rapide

1. **Cloner** ce repo (ou votre fork) et ouvrir le projet UE.
2. **Activer le plugin** *Unreal MCP* dans l‚Äô√©diteur si n√©cessaire.
3. **V√©rifier UE 5.6** : le `.uproject` utilise `"EngineAssociation": "5.6"`.
4. **Configurer** le serveur Python (voir `Python/README.md`) et lancer le serveur MCP.
5. Dans UE : **Project Settings ‚Üí Plugins ‚Üí Unreal MCP**  
   - `ServerHost=127.0.0.1`, `ServerPort=12029` (par d√©faut)  
   - (optionnel) activer `bAutoConnectOnEditorStartup`
6. **Diagnostics** : depuis la page de r√©glages, cliquez **Test Connection** puis **Send Ping**.

## ‚öôÔ∏è R√©glages plugin (r√©sum√©)
- **Network** : host/port, timeouts, heartbeats, auto-connect.
- **Security** : `AllowWrite`, `DryRun`, `RequireCheckout`, `AllowedContentRoots`, `AllowedTools/DeniedTools`.
- **Source Control** : `EnableSourceControl`, `AutoConnectSourceControl`, `PreferredProvider`.
- **Logging** : niveau verbose protocole, dossier de logs.
- **Diagnostics** : boutons `Test Connection`, `Send Ping`, `Open Logs Folder`.

> Par d√©faut, **AllowWrite=false** et **DryRun=true** ‚Üí aucune √©criture n‚Äôest effectu√©e tant que vous n‚Äôavez pas explicitement autoris√©.

## üß∞ Outils expos√©s (MCP Tools)

### Lecture (toujours autoris√©es)
| Tool              | Description                                 | Params cl√©s                                      |
|-------------------|---------------------------------------------|--------------------------------------------------|
| `asset.find`      | Recherche d‚Äôassets via Asset Registry       | `paths[]`, `classNames[]`, `nameContains`, `limit/offset` |
| `asset.exists`    | Existence + classe d‚Äôun asset               | `objectPath`                                     |
| `asset.metadata`  | M√©tadonn√©es (class, tags, deps, size, ‚Ä¶)    | `objectPath`                                     |
| `sc.status`       | Statut SCM par fichier/asset                | `assets[]` ou `files[]`                          |

### Mutations (soumis aux gates & transactions)
| Tool          | Description                   | Remarques |
|---------------|-------------------------------|-----------|
| `sc.checkout` | Checkout d‚Äôun lot de fichiers | No-op possible selon provider (Git) |
| `sc.add`      | Marquer pour ajout            |           |
| `sc.revert`   | Revert local                  |           |
| `sc.submit`   | Submit/commit avec message    |           |

| Tool                    | Description                           | Notes                                                  |
|-------------------------|---------------------------------------|--------------------------------------------------------|
| `asset.create_folder`   | Cr√©er un dossier `/Game/...`          | Respecte `AllowedContentRoots`                         |
| `asset.rename`          | Renommer/d√©placer un asset (package)  | Cr√©e un redirector (corrigez via `asset.fix_redirectors`) |
| `asset.delete`          | Supprimer un ou plusieurs assets      | `force=false` bloque si r√©f√©renc√©                      |
| `asset.fix_redirectors` | Corriger les redirectors dans un path | Utilise `AssetTools`, compatible r√©cursif              |
| `asset.save_all`        | Sauvegarder assets modifi√©s           | Scope global ou par `paths[]`, `modifiedOnly` optionnel |
| `asset.batch_import`    | Importer un lot de fichiers           | Presets FBX/Textures/Audio, dry-run, SCM, conflits      |

#### Actors

| Tool             | Description                          | Notes                                                   |
|------------------|--------------------------------------|---------------------------------------------------------|
| `actor.spawn`    | Instancier un acteur (classe ou BP)  | Transform + tags optionnels, s√©lection possible         |
| `actor.destroy`  | D√©truire un ou plusieurs acteurs     | `allowMissing=true` ignore les r√©f√©rences absentes      |
| `actor.attach`   | Attacher un acteur √† un parent       | Supporte `keepWorldTransform`, `socketName`, weld       |
| `actor.transform`| Appliquer set/add sur location/rot/scale | `set` absolu puis `add` (delta)                        |
| `actor.tag`      | Ajouter/retirer/remplacer des tags   | `replace` (array ou `null`), `add`, `remove`            |

#### Sequencer

| Tool                     | Description                                      | Notes                                                  |
|--------------------------|--------------------------------------------------|--------------------------------------------------------|
| `sequence.create`        | Cr√©e un Level Sequence (fps, dur√©e, eval)        | Cam√©ra Cine + CameraCut optionnels ; bind d'acteurs existants |
| `sequence.bind_actors`   | Lier un ou plusieurs acteurs √† un Sequence       | Options `skipIfAlreadyBound`, `overwriteIfExists`, `labelPrefix`, `save` |
| `sequence.unbind`        | Retirer des bindings par GUID ou acteur          | Mutant ; support `save`, audit d√©taill√©                |
| `sequence.list_bindings` | Lister les bindings existants d'un Sequence      | Read-only ; renvoie GUID, label, acteur courant        |
| `sequence.add_tracks`    | Ajouter des pistes (Transform/Visibility/Property) + cuts cam√©ra | Mutant ; overwrite/dryRun/save, SCM + audit |
| `sequence.export`        | Exporter un Sequence en JSON/CSV (bindings, pistes, cl√©s)        | Read-only ; filtres `include.*`, `frameRange`, CSV aplati |

```jsonc
// Exemple : sequence.create minimal
{
  "sequencePath": "/Game/Cinematics/Seq/SEQ_Intro",
  "displayRate": [24, 1],
  "durationFrames": 240,
  "evaluationType": "WithSubFrames"
}
```

```jsonc
// Exemple : sequence.bind_actors
{
  "sequencePath": "/Game/Cinematics/Seq/SEQ_Intro.SEQ_Intro",
  "actorPaths": [
    "/Game/Maps/UEDPIE_0_Map.Map:PersistentLevel.BP_TrainingDummy_C_2",
    "/Game/Maps/UEDPIE_0_Map.Map:PersistentLevel.CineCam_Intro"
  ],
  "skipIfAlreadyBound": true,
  "labelPrefix": "Dummy_",
  "overwriteIfExists": false,
  "save": true
}
```

```jsonc
// Exemple : sequence.add_tracks (transform + cuts)
{
  "sequencePath": "/Game/Cinematics/Seq/SEQ_Intro.SEQ_Intro",
  "bindings": [
    {
      "actorPath": "/Game/Maps/Map:PersistentLevel.BP_TrainingDummy_C_2",
      "tracks": [
        {
          "type": "Transform",
          "keys": [
            { "frame": 0, "location": [0, 0, 0] },
            { "frame": 120, "location": [0, 300, 0], "rotation": [0, 90, 0] }
          ]
        }
      ]
    }
  ],
  "cameraCuts": [
    { "frameStart": 0, "frameEnd": 60, "cameraBindingId": "3C7C8B2E-1234-5678-ABCD-000000000001" }
  ],
  "overwrite": false,
  "save": true
}
```

```jsonc
// Exemple : sequence.export (JSON)
{
  "sequencePath": "/Game/Cinematics/Seq/SEQ_Intro.SEQ_Intro",
  "format": "json",
  "include": {
    "tracks": ["Transform", "Visibility"],
    "keys": true
  },
  "frameRange": { "start": 0, "end": 120 },
  "worldActorPaths": true
}
```

```jsonc
// Exemple : sequence.export (CSV)
{
  "sequencePath": "/Game/Cinematics/Seq/SEQ_Intro.SEQ_Intro",
  "format": "csv",
  "include": {
    "tracks": ["Transform", "CameraCut"],
    "bindings": true
  },
  "flattenProperties": true
}
```

#### √âditeur

| Tool              | Type      | Description                               | Notes                                                |
|-------------------|-----------|-------------------------------------------|------------------------------------------------------|
| `level.select`    | read-only | S√©lectionner des acteurs par filtres      | `mode=replace|add|remove`, support tags/classes        |
| `viewport.focus`  | read-only | Recentrer la cam√©ra √©diteur               | Acteurs, box ou location; `orbit` = cadrage orbital  |
| `camera.bookmark` | mixte     | `set/jump/list` de bookmarks cam√©ra       | `persist=true` √©crit dans le niveau (mutant + gate)  |

```jsonc
// Exemple : actor.spawn
{
  "classPath": "/Script/Engine.StaticMeshActor",
  "location": [0.0, 0.0, 150.0],
  "rotation": [0.0, 90.0, 0.0],
  "tags": ["SpawnedByMCP"],
  "select": true
}
```

```jsonc
// Exemple : level.select
{
  "filters": {
    "nameContains": "Dummy",
    "classNames": ["BP_TrainingDummy_C"],
    "tags": ["Training"]
  },
  "mode": "replace",
  "selectChildren": false
}
```

```jsonc
// Exemple : viewport.focus
{
  "actors": [
    "/Game/Maps/UEDPIE_0_Untitled.Untitled:PersistentLevel.BP_TrainingDummy_C_2",
    "/Game/Maps/UEDPIE_0_Untitled.Untitled:PersistentLevel.StaticMeshActor_15"
  ],
  "orbit": true,
  "transitionSec": 0.0
}
```

```jsonc
// Exemple : asset.rename
{
  "fromObjectPath": "/Game/Core/Old/BP_SpellProjectile.BP_SpellProjectile",
  "toPackagePath": "/Game/Core/Spells/BP_SpellProjectile"
}

// Exemple : asset.fix_redirectors
{
  "paths": ["/Game/Core", "/Game/Art"],
  "recursive": true
}

// Exemple : asset.batch_import
{
  "destPath": "/Game/Art/Characters/Orc",
  "files": ["D:/Imports/Orc/mesh/Orc.fbx", "D:/Imports/Orc/textures/Orc_Diffuse.png"],
  "preset": "fbx_character"
}
```

> **Transactions & Undo** : chaque mutation est faite dans une transaction √©diteur (Ctrl+Z possible).
> **SCM** : si `RequireCheckout=true`, √©chec si l‚Äôasset n‚Äôest pas checkout.

## üîê Mod√®le de s√©curit√©
- **Read-only par d√©faut** : `AllowWrite=false`.  
- **Dry-run** : si activ√©, les mutations renvoient un **plan** (`audit.actions[]`) sans rien changer.  
- **AllowedContentRoots** : seules les √©critures dans ces chemins `/Game/...` sont permises.  
- **Allow/Deny-list** de tools : bloque/autorise par nom de tool, ex. `sc.submit`.

## üß™ Tests & CI (aper√ßu)
- Protocol v1 test√© (framing, ping/pong, timeouts).  
- Tools lecture test√©s avec l‚ÄôAsset Registry.  
- Mutations envelopp√©es de transactions + SCM optionnel.  
- (Conseill√©) Nightly Automation/Gauntlet pour projets complexes.

## üõ† D√©veloppement local
- C√¥t√© UE : modules `Json`, `JsonUtilities`, `Sockets`, `Networking`, `DeveloperSettings`, `SourceControl`.
- C√¥t√© Python : lib standard (`socket`, `struct`, `json`, `argparse`, `selectors`).

## üßØ Troubleshooting
- **Connection refused (127.0.0.1:12029)** : serveur Python non lanc√© / port erron√© (voir Settings).  
- **WRITE_NOT_ALLOWED** : activer `AllowWrite` **et** v√©rifier `AllowedContentRoots`.  
- **SOURCE_CONTROL_REQUIRED** : activer/brancher le provider SCM ou d√©sactiver `RequireCheckout`.  
- **Ping timeouts** : v√©rifier firewall/antivirus, `ReadTimeoutSec` et `HeartbeatIntervalSec`.

## üìú Licence & Contribuer
- PRs bienvenues (features packs : Assets/Actors, Sequencer, Materials/MI, Niagara, Build/Test).  
- Merci d‚Äôouvrir une issue avec un **use case** clair et crit√®res d‚Äôacceptation.

